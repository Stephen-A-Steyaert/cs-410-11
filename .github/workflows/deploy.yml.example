# Example: Automatic deployment workflow
# Rename to deploy.yml to enable automatic deployment

name: Deploy to Production

on:
  workflow_run:
    workflows: ["Build and Push to GHCR"]
    types:
      - completed
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Deploy to server via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          script: |
            cd /path/to/your/app
            make swarm-update

# Required secrets (Settings → Secrets → Actions):
# - DEPLOY_HOST: your server IP or domain
# - DEPLOY_USER: SSH username (must have access to docker and the app directory)
# - DEPLOY_SSH_KEY: Private SSH key for authentication
#
# Setup:
# 1. Generate SSH key pair: ssh-keygen -t ed25519 -C "github-actions" -f ~/.ssh/deploy_key
# 2. Add public key to server: cat ~/.ssh/deploy_key.pub >> ~/.ssh/authorized_keys
# 3. Add private key to GitHub Secrets as DEPLOY_SSH_KEY
#
# Note: This triggers a rolling update in Docker Swarm (zero downtime)
# If something breaks, SSH into server and run: make swarm-rollback
